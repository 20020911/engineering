<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增菜单</title>
    <link rel="stylesheet" href="layui/css/layui.css" type="text/css">
</head>
<body>
<div class="xm">
    <div class="xm-d1">
        <p class="xm-d1-p">新增菜单</p><br>
    </div>
    <div class="x_content">
        <form class="layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label">菜单名称</label>
                <div class="layui-input-block" style="width: 500px;">
                    <input type="text" id="menuName" name="menuName" lay-verify="text" autocomplete="off" placeholder="请输入名称" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">url路径</label>
                <div class="layui-input-block" style="width: 500px;">
                    <input type="text" id="url" name="url" lay-verify="text" autocomplete="off" placeholder="请输入url" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">菜单序号</label>
                <div class="layui-input-block" style="width: 500px;">
                    <input type="text" id="orderNum" name="orderNum" lay-verify="text" autocomplete="off" placeholder="请输入序号" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">父级菜单</label>
                <div class="layui-input-block" style="width: 500px;">
                    <select name="parentId" lay-filter="aihao" id="parentId">
                        <option value="0" >---请选择---</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="sub">立即提交</button>
                    <button type="submit" class="layui-btn layui-btn-primary" lay-submit="" lay-filter="res">重置</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript" src="assets/libs/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="layui/layui.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script>
    layui.use(['form','layer'], function () {
        var $ = layui.$,form=layui.form,layer = layui.layer;
        var token = $.cookie("token");

        menuList();

        var option = "";
        form.on('submit(sub)',function(data){
            alert(JSON.stringify(data.field));
            var datas = data.field;
            var ref = /^\d[0-9]$/;
            if(datas.menuName =="" || datas.menuName==null){
                alert("请输入菜单名称！");
                return false;
            }
            if(!ref.test(datas.orderNum)){
                alert("请输入正确的序号！");
                return false;
            }
            $.ajax({
                url:"http://localhost:8182/sumer/menu/addMenu",
                data:{
                    "menuName":datas.menuName,
                    "url":datas.url,
                    "parentId":datas.parentId,
                    "orderNum":datas.orderNum,
                },
                type:"post",
                dataType:"json",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('token', token);
                },
                success:function(data){
                    alert(data.message);
                    if(data.code=='200'){
                        location.href="menuList.html";
                    }
                },error:function(data){
                    alert("前台发送异常！");
                }
            })
            return false;
        })
        form.on('submit(res)',function(data){
            return false;
        })
        function menuList(){
            $.ajax({
                url:"http://localhost:8182/sumer/menu/menuLists",
                type:"get",
                dataType:"json",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('token', token);
                },
                success:function(data){
                    option = "";
                    for(var i =0;i<data.data.length;i++){
                        option+="<option value='"+data.data[i].id+"''>"+data.data[i].menuName+"</option>"
                    }
                    $("#parentId").append(option);
                    form.render('select');
                },error:function(data){
                    alert("发生异常！");
                }
            })
        }

    })
</script>
</body>
</html>