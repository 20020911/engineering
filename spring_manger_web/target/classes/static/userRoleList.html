<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>角色用户列表</title>
    <link rel="stylesheet" href="layui/css/layui.css" type="text/css">
</head>
<body>
<form class="layui-form" action="">
    <div class="xm-d1">
        <p class="xm-d1-p">角色列表</p><br>
    </div>
    <div class="layui-form">
        <div class="layui-form-item" id="forms" >
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">用户名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="name" lay-verify="text" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">手机号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="phone" lay-verify="text" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">查询</button>
                </div>
            </div>

        </div>
    </div>
    </div>
</form>
<span><a href="javascript:history.back(-1)" style="text-align: right;color: #801a1a"><b>返回</b></a></span>
<div style="position: absolute;top: 260px;left: 30px;">
    <table id="userRoleList" width="1250" class="layui-hide"  lay-filter="userRoleList"></table>
</div>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="del">删除</a>
</script>
<script src="assets/libs/jquery-3.2.1.min.js"type="text/javascript"></script>
<script src="layui/layui.js"type="text/javascript"></script>
<script src="js/jquery.cookie.js" type="text/javascript"></script>
<script type="text/html" id="xuhao">
    {{d.LAY_TABLE_INDEX+1}}
</script>
<script>
    layui.use(['form','table'],function(){
        var form = layui.form,$=layui.$,table = layui.table;
        var token = $.cookie("token");
        var roleId = $.cookie("roleId");
        var name="";
        var phone = "";
        var cols;
        $.cookie("roleId",'',{ expires: -1 });
        form.on('submit(demo1)',function(data){
            name= data.field.name;
            phone = data.field.phone;
            cols.reload({
                where:{
                    "name":name,
                    "phone":phone,
                    "roleId":roleId,
                },
                page:{
                    curr:1,
                }
            });
            return false;
        })
        cols=table.render({
            elem:"#userRoleList",
            url:"http://localhost:8182/sumer/role/userRoleList",
            method:"post",
            width:1270,
            headers:{
                token:token
            },
            cols:[[
                {title: '序号',templet: '#xuhao'},
                {title:'id',field:'id'},
                {title:'用户名',field:'name'},
                {title:'手机号',field:'phone'},
                {title:'邮箱',field:'email'},
                {title:'性别',templet:function(data){
                        return data.sex==1?"男":"女";
                    }},
                {title:'创建时间',field:'createdDate',templet:"<div>{{layui.util.toDateString(d.creationDate,'yyyy-MM-dd HH:mm:ss')}}</div>"},

                {fixed: 'right', title:'操作', toolbar: '#barDemo', width:300}
            ]],

            page : true,
            request: {
                page:'page',
                limitName: 'pageSize'
            }, where:{
                "name":name,
                "phone":phone,
                "roleId":roleId,
            },
            page:1,
            limit:5,
            parseData: function(res) { //res 即为原始返回的数据
                return {
                    "code": 0,
                    "msg": res.message,
                    "count": res.count,
                    "data": res.data
                };
            },error:function(data){
                alert(JSON.stringify(data));
            },
            limits: [5,7, 10]
        })
        table.on('tool(userRoleList)',function(obj){
            var data = obj.data;
            if(obj.event==='del'){
                if(window.confirm("是否删除此条数据?")){
                    del(data.id);
                }
            }
        })
        function del(id){
            $.ajax({
                url:"http://localhost:8182/sumer/role/delUserRole",
                type:"delete",
                data:{
                    "roleId":roleId,
                    "userId":id,
                },
                dataType:"json",
                beforeSend: function(xhr){
                    //alert("发送之前的设置...... "+token);
                    xhr.setRequestHeader('token', token);
                },
                success:function(data){
                    alert(data.message);
                    cols.reload({
                        where:{
                            "name":name,
                            "phone":phone,
                            "roleId":roleId,
                        },
                        page:{
                            curr:1,
                        }
                    });
                },error:function(msg){
                    alert("发送异常！");
                }
            })
        }
    })
</script>
</body>
</html>