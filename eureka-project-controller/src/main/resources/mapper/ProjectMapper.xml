<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.eurekaprojectcontroller.mapper.ProjectMapper">
    <select id="getProjectList" resultType="com.example.pojo.io.project.PorjectListVO">
        SELECT p.*,d.name AS dictionaryType,u.name AS manager FROM `dictionary` d,`project` p,`user` u
        WHERE p.`p_manager`=u.`id` AND p.`p_state`=d.id
        <if test="name!=null and name!=''">AND p.`p_name` LIKE CONCAT('%',#{name},'%')</if>
        <if test="manager!=null and manager!=''">AND u.name LIKE CONCAT('%',#{manager},'%')</if>
        <if test="state!=0">AND p.`p_state`=#{state}</if>
        limit #{start},#{size}
    </select>
    <select id="getProjectListCount" resultType="Integer">
        SELECT count(*) FROM `dictionary` d,`project` p,`user` u
        WHERE p.`p_manager`=u.`id` AND p.`p_state`=d.id
        <if test="name!=null and name!=''">AND p.`p_name` LIKE CONCAT('%',#{name},'%')</if>
        <if test="manager!=null and manager!=''">AND u.name LIKE CONCAT('%',#{manager},'%')</if>
        <if test="state!=0">AND p.`p_state`=#{state}</if>
    </select>
    <select id="getProject" resultType="com.example.pojo.io.project.PorjectListVO">
        SELECT p.*,d.name AS dictionaryType,u.name AS manager FROM `dictionary` d,`project` p,`user` u
        WHERE p.`p_manager`=u.`id` AND p.`p_state`=d.id
        and p.id=#{id}
    </select>
    <update id="updProject">
        update project
        set p_name=#{p_name},p_id=#{p_id},p_parent=#{p_parent},p_address=#{p_address},p_manager=#{p_manager},p_company=#{p_company},p_state=#{p_state}
        where id=#{id}
    </update>
    <insert id="addProject">
        INSERT INTO `project` (`p_name`, `p_id`, `p_parent`, `p_address`, `p_manager`, `p_company`, `p_state`) VALUES (#{p_name},#{p_id},#{p_parent},#{p_address},#{p_manager},#{p_company},#{p_state});
    </insert>
    <delete id="delProject">
        delete from `project`
        where id=#{id}
    </delete>
    <select id="stateList" resultType="com.example.pojo.io.project.DictionaryVO">
        select * from dictionary
    </select>
</mapper>